{% load thumbnail %}

{% for product in products %}
    <div class="col-lg-4 col-md-6">
        <div class="single-product">
            {% thumbnail product.image "300x300" crop='center' quality=90 as im %}
                <img src="{{ im.url }}" alt="">
            {% endthumbnail %}
            <div class="product-details">
                <h6>{{ product.title }}</h6>
                <div class="price">
                    {% if product.discount_percentage and product.discount_timer.is_active == True %}
                        <h6>${{ product.get_price_after_discount }}</h6>
                        <h6 class="l-through">${{ product.price }}</h6>
                    {% elif product.discount_percentage and product.discount_timer == Null %}
                        <h6>${{ product.get_price_after_discount }}</h6>
                        <h6 class="l-through">${{ product.price }}</h6>
                    {% else %}
                        <h6>${{ product.price }}</h6>
                    {% endif %}
                </div>
                <div class="prd-bottom">

                    <a onclick="listAddToCart({{ product.id }},1)" class="social-info cursor-pointer">
                        <span class="ti-bag"></span>
                        <p class="hover-text">add to bag</p>
                    </a>
                    {% if product in request.user.favorite_products.all %}
                        <a href="{% url 'remove_from_favorites' slug=product.slug %}" class="social-info">
                            <span class="bi bi-heart-fill"></span>
                            <p class="hover-text">remove</p>
                        </a>
                    {% else %}
                        <a href="{% url 'add_to_favorites' slug=product.slug %}" class="social-info">
                            <span class="lnr lnr-heart"></span>
                            <p class="hover-text">add to fav</p>
                        </a>
                    {% endif %}
                    <a href="{{ product.get_absolute_url }}" class="social-info">
                        <span class="lnr lnr-move"></span>
                        <p class="hover-text">view more</p>
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endfor %}