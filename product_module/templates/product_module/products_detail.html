{% extends 'shared/_layout.html' %}
{% load thumbnail %}
{% load render_partial %}
{% load static %}

{% block title %}
    Product Detail
{% endblock %}
{% block header_references %}
    <link rel="stylesheet" href="{% static 'lib/css/lightbox.css' %}">
{% endblock %}
{% block footer_references %}
    <script src="{% static 'lib/js/lightbox.js' %}"></script>
    <script src="{% static 'lib/js/lightbox-plus-jquery.min.js' %}"></script>
{% endblock %}

{% block content %}
    <div class="product_image_area">
        <div class="container">
            {#        {% url 'products_detail' slug=product.slug as product_detail_url %}#}
            {#        {% if request.path == product_detail_url %}#}
            {% if request.path == '/products/'|add:product.slug %}
                {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endif %}
            <div class="row s_product_inner">
                <div class="col-lg-6">
                    <div>
                        <div style="position:relative" class="single-prd-item">
                            {% if product.image %}
                                <a style="color:black;" id="show-main-image-modal" href="{{ product.image.url }}"
                                   data-lightbox="roadtrip">
                                    <img class="img-fluid" src="{{ product.image.url }}" alt="" id="main-image">
                                </a>
                            {% else %}
                                <a style="color:black;" id="show-main-image-modal" href="{{ product.image.url }}"
                                   data-lightbox="roadtrip">
                                    <img class="img-fluid" src="{% static 'img/1.jpg' %}" alt="" id="main-image">
                                </a>
                            {% endif %}
                            <h3 style="position: absolute;right:0">

                            </h3>
                        </div>
                        <div id="similar-product" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner group-gallery">
                                {% for product_gallery in product_galleries %}
                                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                        <div style="padding-left: 20px;">
                                        {% for item in product_gallery %}
                                            <a class="cursor-pointer" onclick="showLargeImage('{{ item.image.url }}')">
                                                {% thumbnail item.image "80x80" crop='center' quality=90 as im %}
                                                    <img src='{{ im.url }}' alt="">
                                                {% endthumbnail %}
                                            </a>
                                        {% endfor %}

                                        </div>
                                    </div>
                                {% endfor %}

                            </div>
                            <a class="right item-control" href="#similar-product" data-slide="next">
                                <i class="fa fa-angle-right"></i>
                            </a>
                            <a class="left item-control" href="#similar-product" data-slide="prev">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5 offset-lg-1">
                    <div class="s_product_text">
                        <h3>{{ product.title }}</h3>
                        <div class="price">
                            {% if product.discount_percentage and product.discount_timer.is_active == True %}
                                <h6 style="text-decoration: line-through">${{ product.price }}</h6>
                                <h4 style="color:orange">${{ product.get_price_after_discount }}</h4>
                            {% elif product.discount_percentage and product.discount_timer == Null %}
                                <h6 style="text-decoration: line-through">${{ product.price }}</h6>
                                <h4 style="color:orange">${{ product.get_price_after_discount }}</h4>
                            {% else %}
                                <h4 style="color:orange">${{ product.price }}</h4>
                            {% endif %}
                        </div>
                        <ul class="list">
                            <li><a class="active" href="#"><span>Brand</span> : {{ product.brand.title }}</a></li>
                            <li><a href="#"><span>Availibility</span> :
                                {% if product.is_active == True %}
                                    Available
                                {% else %}
                                    Not Available
                                {% endif %}
                            </a></li>
                        </ul>
                        <p>{{ product.short_description }}</p>
                        <div class="product_count">
                            <label for="qty">Quantity:</label>
                            <input type="number" name="product_count" id="product_count" min="1" maxlength="12" value="1" title="Quantity:"
                                   class="input-text qty">
{#                            <button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst )) result.value++;return false;"#}
{#                                    class="increase items-count" type="button"><i class="lnr lnr-chevron-up"></i>#}
{#                            </button>#}
{#                            <button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst ) &amp;&amp; sst > 0 ) result.value--;return false;"#}
{#                                    class="reduced items-count" type="button"><i class="lnr lnr-chevron-down"></i>#}
{#                            </button>#}
                        </div>
                        <div class="card_area d-flex align-items-center">
                            <button class="primary-btn" onclick="addProductToOrder({{ product.id }})">Add to Cart</button>
                            {% if product in request.user.favorite_products.all %}
                                <a class="icon_btn" href="{% url 'remove_from_favorites' slug=product.slug %}"><i
                                        class="bi bi-heart-fill"></i></a>
                            {% else %}
                                <a class="icon_btn" href="{% url 'add_to_favorites' slug=product.slug %}"><i
                                        class="lnr lnr lnr-heart"></i></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="product_description_area">
        <div class="container">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                       aria-controls="home"
                       aria-selected="true">Description</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab"
                       aria-controls="contact" aria-selected="false">Comments ({{ comments_count }})</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                    <h3>
                        Introduction:
                    </h3>
                    <p>
                        {{ product.description }}
                    </p>
                </div>
                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="row">
                        <div class="col-lg-6">
                            {% if comments %}
                                {% include 'includes/product_comments_partial.html' %}
                            {% else %}
                                <div class="alert alert-warning">
                                    <p>No comments on this product</p>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-lg-6">
                            {% if request.user.is_authenticated %}
                                <form action="{% url 'products_detail' slug=product.slug %}" method="post"
                                      id="comment-form">
                                    {% csrf_token %}
                                    <div class="review_box">
                                        <h4>Post a comment</h4>
                                        <div class="form-group">
                                            {{ form.text }}
                                            {% for error in form.text.errors %}
                                                <div class="text-danger">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                        <div class="form-group">
                                            {{ form.captcha }}
                                            {{ form.captcha.errors }}
                                        </div>
                                    </div>
                                    <div class="col-md-12 text-right">
                                        <button type="submit" value="submit" class="btn primary-btn">Send Comment
                                        </button>
                                    </div>
                                </form>
                            {% else %}
                                <div class="alert alert-warning">You must logged in to post a comment. <a
                                        href="{% url 'login_page' %}">Log
                                    In</a></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}